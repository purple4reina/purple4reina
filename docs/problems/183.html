<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      183 &middot; Rey Abolofia
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/poole.css">
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/syntax.css">
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://purple4reina.github.io//public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://purple4reina.github.io//public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-1a">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Rey Abolofia
        </a>
      </h1>
      <p class="lead">mathematical and programmatic musings with a few cats</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="https://purple4reina.github.io/">Home</a>

      

      
      
        
          
        
      
        
      
        
      
        
      

      <a class="sidebar-nav-item" href="https://github.com/purple4reina">GitHub</a>
      <a class="sidebar-nav-item" href="https://www.linkedin.com/in/rabolofia/">LinkedIn</a>
    </nav>

    <p class="sidebar-copyright">&copy; 2021. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">183</h1>
  <h2 id="comments">Comments</h2>

<p>A very interestng problem!  It was cool that there were almost two problems in
one here.  The first was how to determine if a fraction is terminating or
non-terminating.  It ends up that as long as the denominator is coprime to all
primes <em>except</em> for 2 and 5, then the fraction is terminating.  Second, it ends
up that finding large powers of large numbers is hard.  Who knew.  Eventually
for Pypy3 when we get to n=1930 calculating P overflows.  The solution for that
was to take the logorithm of P.  This is allowed because we do not need the
actual value of P, we just need to be able to compare it to other Pâ€™s.
Therefore, as long as the function we apply to P is continuously increasing,
the values for P will maintain their size comparison.</p>

<p>Code runs in about 300 milliseconds.</p>

<h2 id="code">Code</h2>

<pre><code class="language-python">import math

def gcd(a, b):
    while b:
        a, b = b, a % b
    return a

def solve(n):
    total = 0
    for k in range(5, n + 1):
        top_p = top_j = 0
        for j in range(1, k + 1):
            split = j * math.log10(k / j)
            if split &gt; top_p:
                top_p = split
                top_j = j
            else:
                break

        top_j //= gcd(k, top_j)
        while top_j % 2 == 0:
            top_j //= 2
        while top_j % 5 == 0:
            top_j //= 5

        if top_j == 1:
            total -= k
        else:
            total += k

    return total

if __name__ == '__main__':
    import sys
    n = eval(sys.argv[1])
    print(solve(n))
</code></pre>

<h2 id="tests">Tests</h2>

<pre><code class="language-python">import pytest
from problem import solve

_test_solve = (
        (100, 2438),
        (1000, 452936),
)

@pytest.mark.parametrize('n,expect', _test_solve)
def test_solve(n, expect):
    assert expect == solve(n)

_test_not_solve = (
        (2000, 1839106),
        (3000, 4135506),
        (4000, 7461508),
        (5000, 11219942),
        (6000, 16393680),
        (7000, 21999104),
        (8000, 28138658),
        (9000, 36265688),
        (10000, 48506996),
        (10000, 45176320),
        (10000, 49417322),
        (10000, 45410190),
        (10000, 45609938),
)

@pytest.mark.parametrize('n,expect', _test_not_solve)
def test_not_solve(n, expect):
    assert expect != solve(n)
</code></pre>

</div>

    </div>

  </body>
</html>
