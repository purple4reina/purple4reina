<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      675 &middot; Rey Abolofia
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/poole.css">
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/syntax.css">
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://purple4reina.github.io//public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://purple4reina.github.io//public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-1a">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Rey Abolofia
        </a>
      </h1>
      <p class="lead">mathematical and programmatic musings with a few cats</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="https://purple4reina.github.io/">Home</a>

      

      
      
        
          
        
      
        
      
        
      
        
      

      <a class="sidebar-nav-item" href="https://github.com/purple4reina">GitHub</a>
      <a class="sidebar-nav-item" href="https://www.linkedin.com/in/rabolofia/">LinkedIn</a>
    </nav>

    <p class="sidebar-copyright">&copy; 2021. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">675</h1>
  <h2 id="comments">Comments</h2>

<p>I’ve done so many of these now it seems like they are all running together.
There wasn’t anything real standout about this one.  As usual it came down to
me actually getting out pen and paper and doing the actual math.  Once that
happened I was able to incrementally get to a working solution.  This doesn’t
run super fast, takes about 37 seconds to get to the answer.</p>

<h2 id="code">Code</h2>

<pre><code class="language-python">modulo = 1000000087

def memoize(fn):
    _cache = {}
    def wrap(*args):
        if args in _cache:
            return _cache[args]
        ret = fn(*args)
        _cache[args] = ret
        return ret
    return wrap

_primes = [2, 3]
def primes():
    for p in _primes:
        yield p
    while True:
        p += 2
        if is_prime(p):
            _primes.append(p)
            yield p

def is_prime(n):
    top = int(n ** 0.5) + 1
    for p in range(3, top, 2):
        if n % p == 0:
            return False
    return True

@memoize
def factors(n):
    top = n ** 0.5
    for p in primes():
        if p &gt; top:
            break
        if n % p == 0:
            n //= p
            e = 1
            while n % p == 0:
                n //= p
                e += 1
            f = {p: e}
            f.update(factors(n))
            return f
    if n == 1:
        return {}
    return {n: 1}

def inv(n, mod):
    t, newt = 0, 1
    r, newr = mod, n
    while newr:
        q = r // newr
        t, newt = newt, t - q * newt
        r, newr = newr, r - q * newr
    return t

def solve(n):
    total, prod, facts = 0, 1, {}
    for i in range(2, n + 1):
        for p, e in factors(i).items():
            oldvar = facts.get(p, 1)
            newvar = oldvar + 2 * e
            facts[p] = newvar
            prod *= newvar * inv(oldvar, modulo)
            prod %= modulo
        total += prod
    return total % modulo

if __name__ == '__main__':
    import sys
    n = eval(sys.argv[1])
    print(solve(n))
</code></pre>

<h2 id="tests">Tests</h2>

<pre><code class="language-python">import pytest
from problem import solve

_test_solve = (
        (10**1, 4821),
        (10**2, 930751395),
        (10**3, 822391759),
        (10**4, 979435692),
)

@pytest.mark.parametrize('n,expect', _test_solve)
def test_solve(n, expect):
    assert expect == solve(n)
</code></pre>

</div>

    </div>

  </body>
</html>
