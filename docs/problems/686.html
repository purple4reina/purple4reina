<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      686 &middot; Rey Abolofia
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/poole.css">
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/syntax.css">
  <link rel="stylesheet" href="https://purple4reina.github.io//public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://purple4reina.github.io//public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://purple4reina.github.io//public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-1a">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Rey Abolofia
        </a>
      </h1>
      <p class="lead">mathematical and programmatic musings with a few cats</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="https://purple4reina.github.io/">Home</a>

      

      
      
        
          
        
      
        
      
        
      
        
      

      <a class="sidebar-nav-item" href="https://github.com/purple4reina">GitHub</a>
      <a class="sidebar-nav-item" href="https://www.linkedin.com/in/rabolofia/">LinkedIn</a>
    </nav>

    <p class="sidebar-copyright">&copy; 2021. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">686</h1>
  <h2 id="comments">Comments</h2>

<p>Finishing two in one day does feel nice.</p>

<p>I’m really liking Ruby’s ability to memoize.  In this solution I used a Hash so
I could avoid recreating large powers of 10 over and over again.  That allowed
me to cut the time down significantly.</p>

<p>The final solution required 20 digits of precision.  I was hoping to be able to
do it with fewer, but no luck.  I had to run it a few times with different
precisions in order to finally come to the answer.</p>

<p>Using ‘ruby-prof’ for a profiler really helps.  It allowed me to test out
different implementations and know exectly where my algorithm was most slow.  I
tried new ways thinking they’d be faster only to find they weren’t.  It was
very interesting at times.</p>

<p>The hardest part of this problem was determining if a number started with some
particular digits.  The obvious solution is to change the number to a string
and then call <code>String#start_with?</code> on it.  But that was incredibly slow.</p>

<h2 id="code">Code</h2>

<pre><code class="language-ruby">class Problem
  POWERS_OF_TEN = Hash.new { |hash, key| hash[key] = 10.pow(key) }

  class &lt;&lt; self
    def p(l, n)
      power = 0
      num_found = 0
      len = num_digits(l)
      raised = 1
      loop do
        power += 1
        raised *= 2
        raised = truncate(raised, 20)
        if truncate(raised, len) == l
          num_found += 1
          return power if num_found == n
        end
      end
    end

    def truncate num, len
      return 0 if len &lt; 1
      diff = num_digits(num) - len
      return num if diff &lt; 1
      power = POWERS_OF_TEN[diff]
      return num.div(power)
    end

    def num_digits num
      num.to_s.length
    end
  end
end

if __FILE__ == $0
  puts Problem.p(123, 678910)
end
</code></pre>

<h2 id="tests">Tests</h2>

<pre><code class="language-ruby">require 'test/unit'
require './problem'

class TestProblem &lt; Test::Unit::TestCase
  [
    [ 12,  1,     7],
    [ 12,  2,    80],
    [123, 45, 12710],
  ].each do |l, n, expect|
    define_method "test_p_#{l}_#{n}" do
      assert_equal expect, Problem.p(l, n)
    end
  end

  [
    [12345, 0, 0],
    [12345, 1, 1],
    [12345, 2, 12],
    [12345, 3, 123],
    [12345, 4, 1234],
    [12345, 5, 12345],
    [12345, 40, 12345],
  ].each do |num, len, expect|
    define_method "test_truncate_#{num}_#{len}" do
      assert_equal expect, Problem.truncate(num, len)
    end
  end
end
</code></pre>

</div>

    </div>

  </body>
</html>
